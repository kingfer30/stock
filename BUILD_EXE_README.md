# EXE打包使用说明

## 快速打包

### 一键打包
```cmd
双击运行 build_exe.bat
或
build_exe.bat
```

打包过程约需 3-5 分钟，完成后会生成 `股票监控系统.exe`

## 前置要求

- Windows 7 及以上
- Python 3.7+
- Node.js 14+
- 至少 500MB 可用磁盘空间

## 打包步骤

脚本会自动完成以下步骤：

1. ✅ 清理旧文件
2. ✅ 构建前端（Vue生产版本）
3. ✅ 安装后端依赖
4. ✅ 复制启动器模板（launcher_template.py）
5. ✅ 使用PyInstaller打包
6. ✅ 整理输出文件

**注意**: 启动器使用预定义的Python模板文件（`launcher_template.py` 或 `launcher_simple.py`），而不是动态生成，确保可靠性。

## 输出文件

```
股票监控系统.exe    # 可执行文件（约40-60MB）
```

## 使用打包后的程序

### 启动程序

双击 `股票监控系统.exe` 即可启动：

1. 会弹出一个黑色命令行窗口（不要关闭）
2. 程序自动在默认浏览器中打开
3. 访问地址: `http://127.0.0.1:8000`

### 停止程序

关闭黑色命令行窗口即可停止服务。

## 分发说明

### 单文件分发

只需要分发一个文件：
```
股票监控系统.exe
```

### 系统要求

运行环境要求：
- Windows 7 及以上
- 无需安装Python
- 无需安装Node.js
- 首次运行可能需要防火墙授权

### 注意事项

1. **防火墙**：首次运行可能会提示防火墙，需要允许访问
2. **杀毒软件**：部分杀毒软件可能误报，需要添加信任
3. **端口占用**：确保8000端口未被占用
4. **文件大小**：exe文件约40-60MB，包含所有依赖

## 打包选项说明

### 当前配置

```cmd
pyinstaller --noconfirm ^
    --onefile              # 打包为单个exe文件
    --windowed             # 无控制台窗口（改为 --console 可显示日志）
    --name "股票监控系统"   # 程序名称
    --add-data "static;static"  # 包含静态文件
    ...
```

### 可选配置

如需显示控制台日志，修改 `build_exe.bat` 中的：
```cmd
--windowed  # 改为 --console
```

如需添加图标，准备一个 `.ico` 文件，然后修改：
```cmd
--icon=NONE  # 改为 --icon=icon.ico
```

## 常见问题

### 1. 打包失败

**问题**: PyInstaller打包失败

**解决方案**:
```cmd
# 清理缓存后重试
rd /s /q build dist
pip uninstall pyinstaller
pip install pyinstaller
build_exe.bat
```

### 2. exe文件过大

**问题**: 生成的exe文件太大（>100MB）

**解决方案**:
- 这是正常现象，因为包含了Python运行时和所有依赖
- 如需减小体积，可使用 `--exclude-module` 排除不需要的模块

### 3. 运行时缺少模块

**问题**: 运行exe时提示缺少某个模块

**解决方案**:
在 `build_exe.bat` 中添加 `--hidden-import`:
```cmd
--hidden-import=模块名
```

### 4. 静态文件找不到

**问题**: 运行后页面空白，提示找不到静态文件

**解决方案**:
- 确保 `--add-data` 路径正确
- 检查 `backend/static` 目录是否存在
- 重新运行打包脚本

### 5. 无法启动浏览器

**问题**: 程序启动了但浏览器没有自动打开

**解决方案**:
- 手动打开浏览器访问 `http://127.0.0.1:8000`
- 检查防火墙是否阻止了程序

### 6. 杀毒软件误报

**问题**: 杀毒软件提示病毒或恶意软件

**解决方案**:
- 这是PyInstaller打包程序的常见问题
- 将exe添加到杀毒软件的信任列表
- 或使用 `--upx-dir` 选项压缩（可能减少误报）

## 高级配置

### 修改端口

编辑 `launcher.py`（由脚本自动生成），修改：
```python
app.run(host='0.0.0.0', port=8000, debug=False)  # 修改端口号
webbrowser.open('http://127.0.0.1:8000')  # 同步修改
```

### 添加启动参数

可以在 `launcher.py` 中添加命令行参数支持。

### 自定义外观

1. 准备图标文件 `icon.ico`（256x256推荐）
2. 修改打包命令中的 `--icon=icon.ico`

## 性能说明

### 文件大小

- **打包后**: 40-60MB（单文件，包含所有依赖）
- **首次启动**: 3-5秒
- **后续启动**: 2-3秒

### 运行要求

- **内存**: 200-400MB
- **CPU**: 极低占用
- **磁盘**: 需要临时解压空间（约100MB）

## 与其他部署方式对比

| 方式 | 优点 | 缺点 | 适用场景 |
|------|------|------|---------|
| **EXE打包** | 无需安装依赖<br>一键启动<br>易于分发 | 文件较大<br>可能误报 | 非技术人员<br>演示展示 |
| **源码部署** | 文件小<br>易于调试<br>可定制 | 需要安装依赖<br>配置复杂 | 开发者<br>技术人员 |
| **生产部署** | 性能最佳<br>稳定可靠 | 需要服务器<br>配置复杂 | 正式上线 |

## 技术细节

### 打包原理

1. **前端**: Vue构建成静态文件
2. **后端**: Flask应用
3. **打包**: PyInstaller将Python应用打包为exe
4. **静态文件**: 一起打包到exe中
5. **启动**: exe自启动Flask服务并打开浏览器

### 依赖管理

所有Python依赖都会被打包进exe，包括：
- Flask
- Flask-CORS
- requests
- urllib3
- 其他标准库

### 临时文件

运行时会在临时目录创建：
- `_MEI` 开头的文件夹（自动清理）
- 包含解压的静态文件和依赖

## 开发建议

### 开发阶段

使用源码运行：
```cmd
start.bat
```

### 测试阶段

打包并测试：
```cmd
build_exe.bat
```

### 发布阶段

1. 完成所有测试
2. 运行 `build_exe.bat`
3. 测试生成的exe
4. 分发给用户

## 更新说明

当代码更新后：

1. 修改源代码
2. 重新运行 `build_exe.bat`
3. 生成新的exe文件
4. 分发给用户更新

## 许可证

打包后的exe程序遵循与源代码相同的许可证。

## 技术支持

如遇到问题：
1. 查看本文档
2. 检查 `build_exe.bat` 的输出日志
3. 提交 Issue 到项目仓库

---

**提示**: 
- 打包过程需要网络连接（下载依赖）
- 首次打包时间较长（5-10分钟）
- 后续打包会更快（依赖已缓存）

